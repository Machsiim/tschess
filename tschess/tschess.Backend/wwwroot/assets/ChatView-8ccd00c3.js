import{o as a,c as i,a as e,w as r,v as l,b as c,F as g,r as p,s as d,t as h,p as v,d as _}from"./index-a0e500f0.js";import{a as u}from"./axios-bff3f665.js";import{_ as f}from"./_plugin-vue_export-helper-c27b6911.js";const m=s=>(v("data-v-466215a1"),s=s(),_(),s),w={class:"chatView"},b=m(()=>e("div",{class:"info"},"Melde dich mit deinen Schul-Zugangsdaten an. Danach wird mit dem Token eine SignalR Verbindung aufgebaut. Hast du in der Datei appsettings.Development.json deinen User als Suchuser hinterlegt, dann kannst du auch andere User mit einem beliebigen Passwort probieren. Wenn du diese Seite in einem 2. Tab aufmachst, dann siehst du wie die Seiten sich die Nachrichten senden. ",-1)),M={class:"loginForm"},k={class:"formRow"},R=m(()=>e("label",{for:"username"},"Username",-1)),S={class:"formRow"},y=m(()=>e("label",{for:"password"},"Password",-1)),V={class:"formRow"},C={key:0,class:"messageForm"},$={class:"log"},U={data(){return{loginModel:{},message:"",messages:[],signalRConnection:null,connected:!1}},methods:{async login(){try{const s=(await u.post("https://localhost:5001/api/users/login",this.loginModel)).data;u.defaults.headers.common.Authorization=`Bearer ${s.token}`,await d.connectWithToken(s.token),this.connected=!0,d.subscribeEvent("ReceiveMessage",this.onReceiveMessage),console.log("Vor Commit"),this.$store.commit("authenticate",s),console.log("this.$store.state.infos.token: "+this.$store.state.infos.token)}catch(s){this.messages.push(`Login failed: ${JSON.stringify(s)}`)}},async sendMessage(){d.sendMessage(this.message)},onReceiveMessage(s){this.messages.push(`Received from SignalR: ${s}`)}},unmounted(){d.unsubscribeEvent("ReceiveMessage",this.onReceiveMessage)}},D=Object.assign(U,{__name:"ChatView",setup(s){return(t,n)=>(a(),i("div",w,[b,e("div",M,[e("div",k,[R,r(e("input",{id:"username",name:"username","onUpdate:modelValue":n[0]||(n[0]=o=>t.loginModel.username=o),type:"text"},null,512),[[l,t.loginModel.username]])]),e("div",S,[y,r(e("input",{id:"password",name:"password","onUpdate:modelValue":n[1]||(n[1]=o=>t.loginModel.password=o),type:"password"},null,512),[[l,t.loginModel.password]])]),e("div",V,[e("button",{onClick:n[2]||(n[2]=o=>t.login())},"Login")])]),t.connected?(a(),i("div",C,[r(e("textarea",{id:"message",type:"text","onUpdate:modelValue":n[3]||(n[3]=o=>t.message=o)},null,512),[[l,t.message]]),e("button",{onClick:n[4]||(n[4]=o=>t.sendMessage())},"Send message")])):c("",!0),e("div",$,[(a(!0),i(g,null,p(t.messages,o=>(a(),i("div",{key:o},h(o),1))),128))])]))}}),N=f(D,[["__scopeId","data-v-466215a1"]]);export{N as default};
